<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì¼ì‹ì¡°ë¦¬ í•©ê²©ë³´ì¡°ê¸° v3.6</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; background-color: #f0f2f5; padding: 15px; margin: 0; -webkit-user-select:none; -moz-user-select:none; -ms-user-select:none; user-select:none; }
        .box { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-width: 500px; margin: auto; }
        h2 { color: #2c3e50; text-align: center; border-bottom: 3px solid #e67e22; padding-bottom: 15px; margin-top: 0; }
        .mode-area { display: flex; gap: 8px; margin-bottom: 20px; }
        .m-btn { flex: 1; padding: 12px; border: 2px solid #e67e22; background: white; border-radius: 10px; cursor: pointer; font-weight: bold; color: #e67e22; }
        .m-btn.on { background: #e67e22; color: white; }
        .display { background: #fffcf0; border: 1px solid #ffd3a3; border-radius: 15px; padding: 20px; min-height: 120px; margin-bottom: 20px; }
        .q-text { font-size: 1.2em; font-weight: bold; color: #d35400; line-height: 1.4; }
        .ans, .req-box { display: none; background: #eef7ff; padding: 18px; border-radius: 12px; margin-top: 15px; font-size: 0.95em; line-height: 1.8; white-space: pre-wrap; word-break: break-all; }
        .ans { border-left: 6px solid #3498db; }
        .req-box { border-left: 6px solid #27ae60; background: #f2fff5; font-size: 0.85em; }
        .main-btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-size: 1.1em; font-weight: bold; cursor: pointer; margin-bottom: 10px; color: white; transition: 0.2s; }
        .go { background: #e67e22; box-shadow: 0 4px #d35400; }
        .go:active { margin-top: 4px; box-shadow: none; }
        .show { background: #34495e; }
        .show-req { background: #27ae60; }
        .reset-btn { background: none; border: none; color: #95a5a6; text-decoration: underline; font-size: 0.85em; cursor: pointer; display: block; margin: 10px auto; }
        .status-msg { text-align: center; font-size: 0.8em; color: #95a5a6; margin-bottom: 10px; }
        hr { border: 0; border-top: 1px dashed #bdc3c7; margin: 15px 0; }
        b { color: #2980b9; }
        .label-fire { color: #e74c3c; font-weight: bold; }
        .label-table { color: #27ae60; font-weight: bold; }
    </style>
</head>
<body oncontextmenu="return false" onselectstart="return false">
<div class="box">
    <h2>ğŸ£ ì¼ì‹ ì‹¤ê¸° ë§ˆìŠ¤í„° v3.6</h2>
    <div class="mode-area">
        <button id="btn1" class="m-btn on" onclick="chgMode('1')">í•œ ê³¼ëª©ì”©</button>
        <button id="btn2" class="m-btn" onclick="chgMode('2')">ì‹œí—˜ ì¡°í•©</button>
    </div>
    <div id="status" class="status-msg">ë°ì´í„° ë¡œë”© ì¤‘...</div>
    <div class="display">
        <div id="qText" class="q-text">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤.</div>
        <div id="aText" class="ans"></div>
        <div id="rText" class="req-box"></div>
    </div>
    <button id="drawBtn" class="main-btn go" onclick="draw()" disabled>ğŸ² ë¬¸ì œ ì¶”ì¶œ</button>
    <button class="main-btn show" onclick="view('ans')">ğŸ’¡ ì†ŒìŠ¤/í™”êµ¬/ì¡°ë¦¬ëŒ€ ë³´ê¸°</button>
    <button class="main-btn show-req" onclick="view('req')">ğŸ“‹ ìš”êµ¬ì‚¬í•­/ì¬ë£Œ ë³´ê¸°</button>
    <button class="reset-btn" onclick="resetList()">ğŸ”„ ëª¨ë“  ë¬¸ì œ ì´ˆê¸°í™” (ë‹¤ì‹œ ì‹œì‘)</button>
</div>

<script>
    const SHEET_ID = '1TUOwcOj-H29i-D4C0E_WZByOoCJsWgBzAvh8zfQOCK0';
    const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;

    let allData = [];
    let list = [];
    let mode = '1';

    async function loadData() {
        try {
            const response = await fetch(URL + "&t=" + new Date().getTime());
            const csvText = await response.text();
            const rows = parseCSV(csvText);
            
            allData = rows.slice(1).map(col => ({
                n: col[0] || '', t: col[1] || '', s: col[2] || '',
                i: col[3] || '', req: col[4] || '', ing: col[5] || '',
                burner: col[6] || 'ì •ë³´ ì—†ìŒ', table: col[7] || 'ì •ë³´ ì—†ìŒ'
            })).filter(item => item.n !== '' && item.n !== 'ê³¼ì œëª…(n)');

            list = [...allData];
            document.getElementById('status').innerText = `âœ… ê³¼ì œ ${allData.length}ê°œ ë¡œë“œ ì™„ë£Œ`;
            document.getElementById('qText').innerText = "ë¬¸ì œë¥¼ ë½‘ì•„ì£¼ì„¸ìš”!";
            document.getElementById('drawBtn').disabled = false;
        } catch (e) {
            document.getElementById('status').innerText = "âŒ ë¡œë“œ ì‹¤íŒ¨. ì‹œíŠ¸ ê²Œì‹œë¥¼ í™•ì¸í•˜ì„¸ìš”.";
        }
    }

    function resetList() {
        list = [...allData];
        alert("ë¬¸ì œ ëª©ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì „ì²´ ê³¼ì œ ì¤‘ì—ì„œ ì¶”ì¶œë©ë‹ˆë‹¤.");
        document.getElementById('qText').innerText = "ìƒˆë¡­ê²Œ ì‹œì‘í•©ë‹ˆë‹¤!";
        document.getElementById('aText').style.display = 'none';
        document.getElementById('rText').style.display = 'none';
    }

    function chgMode(m) {
        mode = m;
        document.getElementById('btn1').className = (m=='1'?'m-btn on':'m-btn');
        document.getElementById('btn2').className = (m=='2'?'m-btn on':'m-btn');
        resetList();
    }

    function draw() {
        if (list.length === 0) {
            alert("ëª¨ë“  ë¬¸ì œë¥¼ ë‹¤ í’€ì—ˆìŠµë‹ˆë‹¤! ëª©ë¡ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.");
            list = [...allData];
        }
        
        document.getElementById('aText').style.display = 'none';
        document.getElementById('rText').style.display = 'none';

        if (mode == '1') {
            let idx = Math.floor(Math.random() * list.length);
            let it = list.splice(idx, 1)[0];
            document.getElementById('qText').innerHTML = `${it.n} (${it.t}ë¶„)`;
            document.getElementById('aText').innerHTML = `
                <b>[í•µì‹¬ ì†ŒìŠ¤]</b><br>${it.s}<hr>
                <span class="label-fire">ğŸ”¥ í™”êµ¬ ì‚¬ìš©:</span><br>${it.burner}<br><br>
                <span class="label-table">ğŸ”ª ì¡°ë¦¬ëŒ€ ì •ë¦¬:</span><br>${it.table}<hr>
                <b>[ğŸ’¡ ì£¼ì˜ì‚¬í•­]</b><br>${it.i}
            `;
            document.getElementById('rText').innerHTML = `<b>[ìš”êµ¬ì‚¬í•­]</b><br>${it.req}<hr><b>[ì§€ê¸‰ì¬ë£Œ]</b><br>${it.ing}`;
        } else {
            if (list.length < 2) list = [...allData];
            let it1 = list.splice(Math.floor(Math.random()*list.length), 1)[0];
            let it2 = list.splice(Math.floor(Math.random()*list.length), 1)[0];
            document.getElementById('qText').innerHTML = `1. ${it1.n}<br>2. ${it2.n}`;
            document.getElementById('aText').innerHTML = `<b><1. ${it1.n}></b><br>ì†ŒìŠ¤: ${it1.s}<br>í™”êµ¬: ${it1.burner}<hr><b><2. ${it2.n}></b><br>ì†ŒìŠ¤: ${it2.s}<br>í™”êµ¬: ${it2.burner}`;
            document.getElementById('rText').innerHTML = `<b>[ìš”êµ¬ì‚¬í•­ ìš”ì•½]</b><br>1. ${it1.n}: ${it1.req}<br><br>2. ${it2.n}: ${it2.req}`;
        }
        document.getElementById('status').innerText = `ë‚¨ì€ ë¬¸ì œ: ${list.length}ê°œ`;
    }

    function view(type) {
        const target = (type === 'ans' ? document.getElementById('aText') : document.getElementById('rText'));
        target.style.display = (target.style.display == 'none' ? 'block' : 'none');
    }

    function parseCSV(text) {
        const p = RegExp(/("(?:"[^"]*")*[^"]*"|[^",]+|(?<=,|^)(?=,|$))/g);
        return text.split('\n').map(row => {
            const matches = row.match(p);
            return matches ? matches.map(m => m.replace(/^"|"$/g, '').replace(/""/g, '"')) : [];
        });
    }

    loadData();
</script>
</body>
</html>
