<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì¼ì‹ì¡°ë¦¬ í•©ê²©ë³´ì¡°ê¸° v3.1</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; background-color: #f0f2f5; padding: 15px; margin: 0; }
        .box { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-width: 500px; margin: auto; }
        h2 { color: #2c3e50; text-align: center; border-bottom: 3px solid #e67e22; padding-bottom: 15px; margin-top: 0; }
        .mode-area { display: flex; gap: 8px; margin-bottom: 20px; }
        .m-btn { flex: 1; padding: 12px; border: 2px solid #e67e22; background: white; border-radius: 10px; cursor: pointer; font-weight: bold; color: #e67e22; }
        .m-btn.on { background: #e67e22; color: white; }
        .display { background: #fffcf0; border: 1px solid #ffd3a3; border-radius: 15px; padding: 20px; min-height: 120px; margin-bottom: 20px; }
        .q-text { font-size: 1.2em; font-weight: bold; color: #d35400; line-height: 1.4; }
        .ans, .req-box { display: none; background: #eef7ff; padding: 18px; border-radius: 12px; margin-top: 15px; font-size: 0.95em; line-height: 1.8; white-space: pre-wrap; }
        .ans { border-left: 6px solid #3498db; }
        .req-box { border-left: 6px solid #27ae60; background: #f2fff5; font-size: 0.85em; }
        .main-btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-size: 1.1em; font-weight: bold; cursor: pointer; margin-bottom: 10px; color: white; transition: 0.2s; }
        .go { background: #e67e22; box-shadow: 0 4px #d35400; }
        .go:active { margin-top: 4px; box-shadow: none; }
        .show { background: #34495e; }
        .show-req { background: #27ae60; }
        .status-msg { text-align: center; font-size: 0.8em; color: #95a5a6; margin-bottom: 10px; }
        hr { border: 0; border-top: 1px dashed #bdc3c7; margin: 15px 0; }
        b { color: #2980b9; }
        .ing-list { color: #555; display: block; margin-top: 5px; font-style: normal; }
    </style>
</head>
<body>
<div class="box">
    <h2>ğŸ£ ì¼ì‹ ì‹¤ê¸° ë§ˆìŠ¤í„° v3.1</h2>
    <div class="mode-area">
        <button id="btn1" class="m-btn on" onclick="chgMode('1')">í•œ ê³¼ëª©ì”©</button>
        <button id="btn2" class="m-btn" onclick="chgMode('2')">ì‹œí—˜ ì¡°í•©</button>
    </div>
    <div id="status" class="status-msg">í´ë¼ìš°ë“œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    <div class="display">
        <div id="qText" class="q-text">ì‹œíŠ¸ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ê³  ìˆìŠµë‹ˆë‹¤.</div>
        <div id="aText" class="ans"></div>
        <div id="rText" class="req-box"></div>
    </div>
    <button id="drawBtn" class="main-btn go" onclick="draw()" disabled>ğŸ² ë¡œë”©ì¤‘...</button>
    <button class="main-btn show" onclick="view('ans')">ğŸ’¡ ì†ŒìŠ¤ ë° ì£¼ì˜ì‚¬í•­ ë³´ê¸°</button>
    <button class="main-btn show-req" onclick="view('req')">ğŸ“‹ ìš”êµ¬ì‚¬í•­ ë° ì¬ë£Œ ë³´ê¸°</button>
</div>

<script>
    // ì…ë ¥í•˜ì‹  êµ¬ê¸€ ì‹œíŠ¸ IDì™€ ì—°ë™
    const SHEET_ID = '1TUOwcOj-H29i-D4C0E_WZByOoCJsWgBzAvh8zfQOCK0';
    const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

    let allData = [];
    let list = [];
    let mode = '1';

    // 1. ë°ì´í„° ë¡œë“œ
    async function loadData() {
        try {
            const response = await fetch(URL);
            const text = await response.text();
            const json = JSON.parse(text.substr(47).slice(0, -2));
            
            allData = json.table.rows.map(row => ({
                n: row.c[0] ? row.c[0].v : '',
                t: row.c[1] ? row.c[1].v : '',
                s: row.c[2] ? row.c[2].v : '',
                i: row.c[3] ? row.c[3].v : '',
                req: row.c[4] ? row.c[4].v : '',
                ing: row.c[5] ? row.c[5].v : ''
            })).filter(item => item.n !== 'ê³¼ì œëª…(n)' && item.n !== ''); // í—¤ë” ì œì™¸

            list = [...allData];
            document.getElementById('status').innerText = `âœ… ê³¼ì œ ${allData.length}ê°œ ë¡œë“œ ì™„ë£Œ`;
            document.getElementById('qText').innerText = "ì¤€ë¹„ ì™„ë£Œ! ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.";
            document.getElementById('drawBtn').disabled = false;
            document.getElementById('drawBtn').innerText = "ğŸ² ë‹¤ìŒ ë¬¸ì œ ì¶”ì¶œ";
        } catch (e) {
            document.getElementById('status').innerText = "âŒ ë¡œë“œ ì‹¤íŒ¨ (ê³µìœ  ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”)";
            console.error(e);
        }
    }

    function chgMode(m) {
        mode = m;
        document.getElementById('btn1').className = (m=='1'?'m-btn on':'m-btn');
        document.getElementById('btn2').className = (m=='2'?'m-btn on':'m-btn');
        list = [...allData];
    }

    function draw() {
        if (list.length === 0) list = [...allData];
        
        document.getElementById('aText').style.display = 'none';
        document.getElementById('rText').style.display = 'none';

        if (mode == '1') {
            let idx = Math.floor(Math.random() * list.length);
            let it = list.splice(idx, 1)[0];
            document.getElementById('qText').innerHTML = `${it.n} (${it.t}ë¶„)`;
            document.getElementById('aText').innerHTML = `<b>[í•µì‹¬ ì†ŒìŠ¤]</b><br>${it.s}<hr><b>[ì£¼ì˜ì‚¬í•­]</b><br>${it.i}`;
            document.getElementById('rText').innerHTML = `<b>[ìš”êµ¬ì‚¬í•­]</b><br>${it.req}<hr><b>[ì§€ê¸‰ì¬ë£Œ]</b><br><i class="ing-list">${it.ing}</i>`;
        } else {
            if (list.length < 2) list = [...allData];
            let idx1 = Math.floor(Math.random() * list.length);
            let it1 = list.splice(idx1, 1)[0];
            let idx2 = Math.floor(Math.random() * list.length);
            let it2 = list.splice(idx2, 1)[0];
            
            document.getElementById('qText').innerHTML = `1. ${it1.n}<br>2. ${it2.n}`;
            document.getElementById('aText').innerHTML = `<b><1. ${it1.n}></b><br>${it1.s}<hr><b><2. ${it2.n}></b><br>${it2.s}`;
            document.getElementById('rText').innerHTML = `<b><1. ${it1.n}></b><br>${it1.req}<br><i>ì¬ë£Œ: ${it1.ing}</i><hr><b><2. ${it2.n}></b><br>${it2.req}<br><i>ì¬ë£Œ: ${it2.ing}</i>`;
        }
    }

    function view(type) {
        const target = (type === 'ans' ? document.getElementById('aText') : document.getElementById('rText'));
        target.style.display = (target.style.display == 'none' ? 'block' : 'none');
    }

    loadData();
</script>
</body>
</html>
