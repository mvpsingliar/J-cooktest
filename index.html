<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì¼ì‹ì¡°ë¦¬ í•©ê²©ë³´ì¡°ê¸° v4.2</title>
    <style>
        body { font-family: 'Apple SD Gothic Neo', sans-serif; background-color: #f0f2f5; padding: 15px; margin: 0; -webkit-user-select:none; user-select:none; }
        .box { background: white; border-radius: 20px; padding: 25px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); max-width: 500px; margin: auto; }
        h2 { color: #2c3e50; text-align: center; border-bottom: 3px solid #e67e22; padding-bottom: 15px; margin-top: 0; }
        .mode-area { display: flex; gap: 8px; margin-bottom: 20px; }
        .m-btn { flex: 1; padding: 12px; border: 2px solid #e67e22; background: white; border-radius: 10px; cursor: pointer; font-weight: bold; color: #e67e22; }
        .m-btn.on { background: #e67e22; color: white; }
        .display { background: #fffcf0; border: 1px solid #ffd3a3; border-radius: 15px; padding: 15px; min-height: 120px; margin-bottom: 20px; }
        .q-text { font-size: 1.15em; font-weight: bold; color: #d35400; line-height: 1.6; text-align: left; }
        
        /* í…ìŠ¤íŠ¸ ë°•ìŠ¤ ì„¤ì •: ì™¼ìª½ ëì— ë¶™ë„ë¡ padding ì¡°ì • */
        .ans, .req-box { display: none; background: #eef7ff; padding: 15px 10px; border-radius: 12px; margin-top: 15px; font-size: 0.95em; line-height: 1.7; white-space: pre-wrap; word-break: break-all; text-align: left; }
        .ans { border-left: 6px solid #3498db; }
        .req-box { border-left: 6px solid #27ae60; background: #f2fff5; font-size: 0.85em; }
        
        .main-btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-size: 1.1em; font-weight: bold; cursor: pointer; margin-bottom: 10px; color: white; transition: 0.2s; }
        .go { background: #e67e22; box-shadow: 0 4px #d35400; }
        .go:active { margin-top: 4px; box-shadow: none; }
        .show { background: #34495e; }
        .show-req { background: #27ae60; }
        .reset-btn { background: none; border: none; color: #95a5a6; text-decoration: underline; font-size: 0.85em; cursor: pointer; display: block; margin: 10px auto; }
        .status-msg { text-align: center; font-size: 0.85em; color: #7f8c8d; margin-bottom: 10px; font-weight: bold; }
        hr { border: 0; border-top: 1px dashed #3498db; margin: 12px 0; }
        
        /* í•­ëª©ë³„ ê°•ì¡° ìŠ¤íƒ€ì¼ */
        .sub-title { font-size: 1.05em; color: #2c3e50; font-weight: bold; display: block; margin-bottom: 5px; border-bottom: 1px solid #3498db; padding-bottom: 2px; }
        .label-fire { color: #e74c3c; font-weight: bold; }
        .label-table { color: #27ae60; font-weight: bold; }
        .label-point { color: #2980b9; font-weight: bold; }
        .time-tag { font-size: 0.85em; color: #7f8c8d; font-weight: normal; }
    </style>
</head>
<body oncontextmenu="return false">
<div class="box">
    <h2>ğŸ£ ì¼ì‹ ì‹¤ê¸° ë§ˆìŠ¤í„° v4.2</h2>
    <div class="mode-area">
        <button id="btn1" class="m-btn on" onclick="chgMode('1')">í•œ ê³¼ëª©ì”©</button>
        <button id="btn2" class="m-btn" onclick="chgMode('2')">ì‹œí—˜ ì¡°í•©</button>
    </div>
    <div id="status" class="status-msg">ë°ì´í„° ë¡œë”© ì¤‘...</div>
    <div class="display">
        <div id="qText" class="q-text">ì¶”ì¶œ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.</div>
        <div id="aText" class="ans"></div>
        <div id="rText" class="req-box"></div>
    </div>
    <button id="drawBtn" class="main-btn go" onclick="draw()" disabled>ğŸ² ë¬¸ì œ ì¶”ì¶œ</button>
    <button class="main-btn show" onclick="view('ans')">ğŸ’¡ ì†ŒìŠ¤/í™”êµ¬/ì¡°ë¦¬ëŒ€ ë³´ê¸°</button>
    <button class="main-btn show-req" onclick="view('req')">ğŸ“‹ ìš”êµ¬ì‚¬í•­/ì¬ë£Œ ë³´ê¸°</button>
    <button class="reset-btn" onclick="fullReset()">ğŸ”„ ëª¨ë“  ë°ì´í„° ì´ˆê¸°í™” (ë‹¤ì‹œ ì‹œì‘)</button>
</div>

<script>
    const SHEET_ID = '1TUOwcOj-H29i-D4C0E_WZByOoCJsWgBzAvh8zfQOCK0';
    const URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;

    let allData = [];
    let list = [];
    let mode = '1';
    let comboCount = 0;

    async function loadData() {
        try {
            const response = await fetch(URL + "&t=" + new Date().getTime());
            const csvText = await response.text();
            const rows = parseCSV(csvText);
            
            allData = rows.slice(1).map(col => ({
                n: col[0] || '', t: col[1] || '0', s: col[2] || '',
                i: col[3] || '', req: col[4] || '', ing: col[5] || '',
                burner: col[6] || '-', table: col[7] || '-'
            })).filter(item => item.n !== '' && item.n !== 'ê³¼ì œëª…(n)');

            fullReset();
            document.getElementById('drawBtn').disabled = false;
        } catch (e) {
            document.getElementById('status').innerText = "âŒ ë°ì´í„° ì—°ê²° ì‹¤íŒ¨";
        }
    }

    function fullReset() {
        list = [...allData];
        comboCount = 0;
        updateStatus();
        document.getElementById('qText').innerText = "ì¶”ì¶œ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”!";
        document.getElementById('aText').style.display = 'none';
        document.getElementById('rText').style.display = 'none';
    }

    function updateStatus() {
        if (mode == '1') {
            document.getElementById('status').innerText = `ë‚¨ì€ ê³¼ì œ: ${list.length} / ì „ì²´: ${allData.length}`;
        } else {
            const shorts = allData.filter(x => parseInt(x.t) <= 20).length;
            const longs = allData.filter(x => parseInt(x.t) > 20).length;
            document.getElementById('status').innerText = `ëˆ„ì  ì¡°í•© ì—°ìŠµ: ${comboCount}íšŒ (ì´ ${shorts * longs}ê°€ì§€)`;
        }
    }

    function chgMode(m) {
        mode = m;
        document.getElementById('btn1').className = (m=='1'?'m-btn on':'m-btn');
        document.getElementById('btn2').className = (m=='2'?'m-btn on':'m-btn');
        fullReset();
    }

    function draw() {
        document.getElementById('aText').style.display = 'none';
        document.getElementById('rText').style.display = 'none';

        if (mode == '1') {
            if (list.length === 0) { alert("ëª¨ë“  ê³¼ì œë¥¼ ì—°ìŠµí–ˆìŠµë‹ˆë‹¤! ì´ˆê¸°í™”í•©ë‹ˆë‹¤."); list = [...allData]; }
            let it = list.splice(Math.floor(Math.random() * list.length), 1)[0];
            renderOne(it);
        } else {
            const shorts = allData.filter(x => parseInt(x.t) <= 20);
            const longs = allData.filter(x => parseInt(x.t) > 20);
            const it1 = shorts[Math.floor(Math.random() * shorts.length)];
            const it2 = longs[Math.floor(Math.random() * longs.length)];
            comboCount++;
            renderTwo(it1, it2);
        }
        updateStatus();
    }

    function renderOne(it) {
        document.getElementById('qText').innerHTML = `${it.n} <span class="time-tag">(${it.t}ë¶„)</span>`;
        document.getElementById('aText').innerHTML = `
<span class="sub-title">í•µì‹¬ ì†ŒìŠ¤</span>${it.s}
<hr>
<span class="label-fire">ğŸ”¥ í™”êµ¬:</span> ${it.burner}
<br>
<span class="label-table">ğŸ”ª ì¡°ë¦¬ëŒ€:</span> ${it.table}
<hr>
<span class="label-point">ğŸ’¡ ì£¼ì˜ì‚¬í•­:</span> ${it.i}`;
        
        document.getElementById('rText').innerHTML = `
<span class="sub-title">ìš”êµ¬ì‚¬í•­</span>${it.req}
<hr>
<span class="sub-title">ì§€ê¸‰ì¬ë£Œ</span>${it.ing}`;
    }

    function renderTwo(it1, it2) {
        document.getElementById('qText').innerHTML = `1. ${it1.n} (${it1.t}ë¶„)<br>2. ${it2.n} (${it2.t}ë¶„)`;
        document.getElementById('aText').innerHTML = `
<span class="sub-title">1. ${it1.n}</span>
<b>ì†ŒìŠ¤:</b> ${it1.s}<br>
<span class="label-fire">ğŸ”¥ í™”êµ¬:</span> ${it1.burner}<br>
<span class="label-table">ğŸ”ª ì¡°ë¦¬ëŒ€:</span> ${it1.table}<br>
<b>ì£¼ì˜:</b> ${it1.i}
<hr>
<span class="sub-title">2. ${it2.n}</span>
<b>ì†ŒìŠ¤:</b> ${it2.s}<br>
<span class="label-fire">ğŸ”¥ í™”êµ¬:</span> ${it2.burner}<br>
<span class="label-table">ğŸ”ª ì¡°ë¦¬ëŒ€:</span> ${it2.table}<br>
<b>ì£¼ì˜:</b> ${it2.i}`;

        document.getElementById('rText').innerHTML = `
<span class="sub-title">1. ${it1.n}</span>
${it1.req}<br><b>[ì¬ë£Œ]</b>: ${it1.ing}
<hr>
<span class="sub-title">2. ${it2.n}</span>
${it2.req}<br><b>[ì¬ë£Œ]</b>: ${it2.ing}`;
    }

    function view(type) {
        const target = (type === 'ans' ? document.getElementById('aText') : document.getElementById('rText'));
        target.style.display = (target.style.display == 'none' ? 'block' : 'none');
    }

    function parseCSV(text) {
        const p = RegExp(/("(?:"[^"]*")*[^"]*"|[^",]+|(?<=,|^)(?=,|$))/g);
        return text.split('\n').map(row => {
            const matches = row.match(p);
            return matches ? matches.map(m => m.replace(/^"|"$/g, '').replace(/""/g, '"')) : [];
        });
    }

    loadData();
</script>
</body>
</html>
